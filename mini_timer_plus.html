<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Comfort Air — Notion Timer Mini Plus</title>
    <style>
      :root {
        /* colour palette similar to the Comfort theme */
        --bg: #0b1220;
        --panel: #0f142b;
        --text: #d9e2ef;
        --accent: #1fb6ff;
        --accent-2: #34d399;
        --danger: #ef4444;
        --ringBase: rgba(255, 255, 255, 0.08);
      }
      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: Inter, ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica,
          Arial, Apple Color Emoji, Segoe UI Emoji;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      .card {
        background: linear-gradient(
          to bottom right,
          rgba(255, 255, 255, 0.06),
          rgba(255, 255, 255, 0.03)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 12px 32px rgba(0, 0, 0, 0.35);
        border-radius: 18px;
        padding: 16px;
        width: min(340px, 92vw);
      }
      .label {
        font-weight: 700;
        font-size: 1.3rem;
        text-align: center;
        margin-bottom: 10px;
      }
      .ring {
        width: 160px;
        height: 160px;
        border-radius: 28px;
        margin: 0 auto 12px;
        position: relative;
        padding: 8px;
        background: radial-gradient(
            120px 120px at 25% 25%,
            var(--accent) 15%,
            transparent
          ),
          radial-gradient(
            120px 120px at 75% 75%,
            var(--accent-2) 15%,
            transparent
          );
      }
      .ring .track {
        position: absolute;
        inset: 0;
        border-radius: 28px;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.08),
          0 10px 30px rgba(31, 182, 255, 0.25);
      }
      .ring .arc {
        position: absolute;
        inset: 8px;
        border-radius: 20px;
        background: conic-gradient(var(--accent) 0%, var(--ringBase) 0%);
      }
      .ring .inner {
        position: absolute;
        inset: 20px;
        border-radius: 16px;
        background: rgba(0, 0, 0, 0.45);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .digits {
        font-weight: 900;
        font-size: 64px;
        letter-spacing: 2px;
        color: #ffffff;
      }
      .controls {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 12px;
      }
      .btn {
        border-radius: 12px;
        padding: 6px 14px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.08);
        color: var(--text);
        font-weight: 600;
        cursor: pointer;
      }
      .btn.primary {
        background: var(--accent);
        color: #001019;
        border-color: transparent;
      }
      .status {
        font-size: 0.8rem;
        text-align: center;
        margin-top: 8px;
        color: rgba(255, 255, 255, 0.6);
      }
      /* small settings panel */
      .settings {
        margin-top: 12px;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        font-size: 0.8rem;
        align-items: end;
      }
      .settings label {
        display: flex;
        flex-direction: column;
        gap: 4px;
        color: rgba(255, 255, 255, 0.8);
      }
      .settings input[type="number"] {
        width: 100%;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.06);
        color: var(--text);
        padding: 4px 6px;
        font-size: 0.8rem;
      }
      .settings .sound {
        display: flex;
        align-items: center;
        gap: 6px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.8rem;
      }
      .settings .apply-btn {
        grid-column: span 2;
        margin-top: 4px;
        padding: 6px;
        background: var(--accent-2);
        color: #001019;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }
      /* Flash animation when timer ends */
      @keyframes flash {
        0%, 100% { box-shadow: none; }
        50% { box-shadow: 0 0 24px 12px var(--accent); }
      }
      .flash {
        animation: flash 1s ease-in-out 2;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="label" id="lbl">Session</div>
      <div class="ring">
        <div class="track"></div>
        <div class="arc" id="arc"></div>
        <div class="inner">
          <div class="digits" id="digits">25:00</div>
        </div>
      </div>
      <div class="controls">
        <button id="start" class="btn primary">Start</button>
        <button id="reset" class="btn">Reset</button>
        <button id="skip" class="btn">Skip</button>
      </div>
      <div class="status" id="status">Stopped</div>
      <div class="settings" id="settings">
        <label>
          Work (min)
          <input type="number" id="workInput" min="1" max="240" value="25" />
        </label>
        <label>
          Break (min)
          <input type="number" id="breakInput" min="1" max="120" value="5" />
        </label>
        <div class="sound">
          <input type="checkbox" id="soundToggle" checked />
          <span>Sound</span>
        </div>
        <button class="apply-btn" id="applyBtn">Apply</button>
      </div>
    </div>
    <script>
      // Mini plus timer logic
      const ui = {
        lbl: document.getElementById('lbl'),
        digits: document.getElementById('digits'),
        arc: document.getElementById('arc'),
        start: document.getElementById('start'),
        reset: document.getElementById('reset'),
        skip: document.getElementById('skip'),
        status: document.getElementById('status'),
        workInput: document.getElementById('workInput'),
        breakInput: document.getElementById('breakInput'),
        applyBtn: document.getElementById('applyBtn'),
        soundToggle: document.getElementById('soundToggle'),
      };
      function fmt(n) {
        return String(n).padStart(2, '0');
      }
      const timer = {
        work: 25 * 60,
        break: 5 * 60,
        left: 25 * 60,
        running: false,
        phase: 'work',
        sound: true,
      };

      // WebAudio context and chime function for end-of-session beep
      let ctx = null;
      function ensureAudio() {
        if (ctx) return true;
        try {
          ctx = new (window.AudioContext || window.webkitAudioContext)();
          return true;
        } catch (e) {
          return false;
        }
      }
      function chime() {
        if (!timer.sound || !ctx) return;
        const master = ctx.createGain();
        master.connect(ctx.destination);
        master.gain.value = 0.6;
        const now = ctx.currentTime;
        // play three ascending tones similar to original timer
        [[880, 0.0, 0.18], [1175, 0.22, 0.22], [1568, 0.48, 0.24]].forEach(
          ([freq, start, dur]) => {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(freq, now + start);
            gain.gain.setValueAtTime(0.001, now + start);
            gain.gain.exponentialRampToValueAtTime(0.4, now + start + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.001, now + start + dur);
            osc.connect(gain).connect(master);
            osc.start(now + start);
            osc.stop(now + start + dur + 0.02);
          }
        );
      }
      let iv = null;
      function paint() {
        const m = Math.floor(timer.left / 60);
        const s = timer.left % 60;
        ui.digits.textContent = `${fmt(m)}:${fmt(s)}`;
        const total = timer.phase === 'work' ? timer.work : timer.break;
        const pct = (1 - timer.left / Math.max(1, total)) * 100;
        ui.arc.style.background = `conic-gradient(var(--accent) ${pct}%, var(--ringBase) ${pct}%)`;
      }
      function start() {
        if (timer.running) return;
        timer.running = true;
        ui.status.textContent = 'Running';
        iv = setInterval(() => {
          if (timer.left <= 0) {
            done();
            return;
          }
          timer.left--;
          paint();
        }, 1000);
      }
      function pause() {
        timer.running = false;
        ui.status.textContent = 'Paused';
        clearInterval(iv);
      }
      function reset() {
        timer.left = timer.phase === 'work' ? timer.work : timer.break;
        paint();
      }
      function done() {
        pause();
        timer.phase = timer.phase === 'work' ? 'break' : 'work';
        timer.left = timer.phase === 'work' ? timer.work : timer.break;
        ui.status.textContent = timer.phase === 'work' ? 'Work' : 'Break';
        paint();
        // alert user with sound and visual flash
        if (timer.sound) {
          ensureAudio();
          chime();
        }
        const card = document.querySelector('.card');
        card.classList.add('flash');
        setTimeout(() => card.classList.remove('flash'), 2000);
      }
      ui.start.addEventListener('click', () => {
        if (timer.running) {
          pause();
          ui.start.textContent = 'Start';
        } else {
          start();
          ui.start.textContent = 'Pause';
        }
      });
      ui.reset.addEventListener('click', () => {
        pause();
        reset();
        ui.start.textContent = 'Start';
        ui.status.textContent = 'Stopped';
      });
      ui.skip.addEventListener('click', () => {
        timer.left = 0;
        done();
      });
      ui.applyBtn.addEventListener('click', () => {
        const w = parseInt(ui.workInput.value, 10);
        const b = parseInt(ui.breakInput.value, 10);
        if (Number.isFinite(w) && w > 0) timer.work = Math.min(240, Math.max(1, w)) * 60;
        if (Number.isFinite(b) && b > 0) timer.break = Math.min(120, Math.max(1, b)) * 60;
        timer.left = timer.phase === 'work' ? timer.work : timer.break;
        pause();
        paint();
        ui.start.textContent = 'Start';
        ui.status.textContent = 'Updated';
      });

      // toggle sound on/off
      ui.soundToggle.addEventListener('change', () => {
        timer.sound = ui.soundToggle.checked;
      });
      // Parse URL parameters on load
      function fromURL() {
        const p = new URLSearchParams(window.location.search);
        const label = p.get('label');
        const mins = Number(p.get('mins'));
        const brk = Number(p.get('break'));
        if (Number.isFinite(mins)) {
          ui.workInput.value = mins;
          timer.work = Math.min(240, Math.max(1, mins)) * 60;
        }
        if (Number.isFinite(brk)) {
          ui.breakInput.value = brk;
          timer.break = Math.min(120, Math.max(1, brk)) * 60;
        }
        timer.left = timer.work;
        if (label) ui.lbl.textContent = label;
        paint();
      }
      fromURL();
    </script>
  </body>
</html>
